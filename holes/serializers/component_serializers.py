from rest_framework import serializers
from holes.models import Component, Hole
import re

class BasicComponentSerializer(serializers.ModelSerializer):
    '''
    Used in GET, POST /components/

    Serializer details:
        BasicComponentSerializer():
            id = CharField(max_length=11, validators=[<UniqueValidator(queryset=Component.objects.all())>])
            producer = CharField(max_length=40)
            product = CharField(max_length=40)
            version = CharField(max_length=40)
            timestamp = DateTimeField(read_only=True)

        validate_id(self, value) is automatically called when new Component object is created.
    '''
    class Meta:
        model = Component
        fields=('__all__')
        read_only_fields=('timestamp',)

    def validate_id(self, value):
        p = re.compile('^[0-9]{4}/[0-9]{1,}$')
        if p.match(value) == None:
             raise serializers.ValidationError("Invalid ID format.")
        return value
        
class UpdateComponentSerializer(serializers.ModelSerializer):
    '''
    Used in PUT, PATCH /components/<pk>/

    Serializer details:
        UpdateComponentSerializer():
            id = CharField(read_only=True)
            producer = CharField(max_length=40)
            product = CharField(max_length=40)
            version = CharField(max_length=40)
            timestamp = DateTimeField(read_only=True)
    '''
    class Meta:
        model = Component
        fields=('__all__')
        read_only_fields=('id','timestamp')

class URLComponentSerializer(serializers.HyperlinkedModelSerializer):
    '''
        Used in GET /components/<pk>/

        URLComponentSerializer():
            id = CharField(max_length=11, validators=[<UniqueValidator(queryset=Component.objects.all())>])
            holes = HyperlinkedRelatedField(many=True, queryset=Hole.objects.all(), view_name='hole-detail')
            producer = CharField(max_length=40)
            product = CharField(max_length=40)
            version = CharField(max_length=40)
            timestamp = DateTimeField(read_only=True)
    '''

    class Meta:
        model = Component
        fields=('id', 'holes', 'producer', 'product', 'version', 'timestamp')